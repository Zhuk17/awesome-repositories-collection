name: Auto-Translate READMEs

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ README.md –Ω–∞ —Ä—É—Å—Å–∫–∏–π –∏ –∫–∏—Ç–∞–π—Å–∫–∏–π —è–∑—ã–∫–∏
# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ README.md —Ñ–∞–π–ª–∞

on:
  push:
    branches:
      - main
    paths:
      - 'README.md'
  workflow_dispatch:
    inputs:
      source_language:
        description: 'Source language (en, ru, zh-CN)'
        required: true
        default: 'en'
        type: choice
        options:
          - en
          - ru
          - zh-CN
      target_languages:
        description: 'Target languages (comma-separated: en,ru,zh-CN)'
        required: true
        default: 'ru,zh-CN'

jobs:
  translate-readmes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: 'requirements.txt'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run translation
        env:
          SOURCE_LANG: ${{ github.event.inputs.source_language || 'en' }}
          TARGET_LANGS: ${{ github.event.inputs.target_languages || 'ru,zh-CN' }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤–æ–¥–∞..."
          echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è argostranslate..."
          python scripts/translate_readmes.py
      
      - name: Commit and push translations
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
          git add README.ru.md README.zh-CN.md
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff --staged --quiet; then
            echo "‚ú® –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            echo "üìù –ö–æ–º–º–∏—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤..."
            git commit -m "üåç chore: auto-update README translations [skip ci]"
            git push
            echo "‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!"
          fi
